<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Wardian – Doble Encriptación</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      color-scheme: dark;
      --bg-main: #050509;
      --bg-card: #0f0f13;
      --bg-input: #050509;
      --border-soft: rgba(255,255,255,0.08);
      --border-strong: rgba(255,255,255,0.16);
      --text-main: #f5f5f7;
      --text-soft: #a1a1aa;
      --accent: #007aff;
      --accent-soft: rgba(0,122,255,0.15);
      --error: #ff453a;
      --radius-card: 18px;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 40px rgba(0,0,0,0.65);
      --font-sans: -apple-system, BlinkMacSystemFont, "SF Pro Text",
                   system-ui, "Segoe UI", sans-serif;
      --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
                   "Liberation Mono", "Courier New", monospace;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: var(--font-sans);
      background: radial-gradient(circle at top, #16161c 0, #020208 60%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 24px 12px;
    }

    .shell {
      width: 100%;
      max-width: 980px;
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-card);
      padding: 24px 22px 26px;
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(22px);
      margin-bottom: 18px;
    }

    header {
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border-soft);
      padding-bottom: 14px;
    }

    header h1 {
      margin: 0 0 6px;
      font-size: 1.9rem;
      font-weight: 600;
      letter-spacing: .06em;
      text-transform: uppercase;
    }

    header .subtitle {
      font-size: .9rem;
      color: var(--text-soft);
      max-width: 520px;
    }

    .badges {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .badge {
      font-size: .75rem;
      padding: 3px 11px;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-soft);
      color: var(--text-soft);
    }

    h2 {
      margin: 0 0 6px;
      font-size: 1.05rem;
      font-weight: 600;
    }

    .section-desc {
      margin: 0 0 12px;
      font-size: .85rem;
      color: var(--text-soft);
    }

    label {
      display: block;
      font-size: .85rem;
      margin-bottom: 4px;
    }

    input, textarea {
      width: 100%;
      border-radius: 11px;
      border: 1px solid var(--border-soft);
      background: var(--bg-input);
      color: var(--text-main);
      font-family: var(--font-sans);
      font-size: .9rem;
      padding: 9px 11px;
      resize: vertical;
    }

    textarea { min-height: 70px; }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
      background: #020208;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    button {
      border: none;
      border-radius: var(--radius-pill);
      padding: 7px 16px;
      font-size: .85rem;
      font-weight: 500;
      cursor: pointer;
      background: var(--accent);
      color: #f9fafb;
      box-shadow: 0 8px 18px rgba(0,122,255,0.35);
    }

    button.secondary {
      background: #18181c;
      color: var(--text-main);
      border: 1px solid var(--border-strong);
      box-shadow: none;
    }

    .output {
      margin-top: 6px;
      border-radius: 10px;
      border: 1px dashed var(--border-soft);
      background: #050509;
      font-family: var(--font-mono);
      font-size: .8rem;
      padding: 7px 10px;
      min-height: 32px;
      display: flex;
      align-items: center;
      color: var(--text-soft);
      word-break: break-all;
    }

    .error {
      margin-top: 4px;
      font-size: .78rem;
      color: var(--error);
      min-height: 14px;
    }

    footer {
      margin-top: 4px;
      font-size: .78rem;
      color: var(--text-soft);
      text-align: right;
    }

    @media (max-width: 720px) {
      .card { padding: 18px 16px 20px; }
      header h1 { font-size: 1.6rem; }
    }
  </style>
</head>
<body>
<div class="shell">
  <div class="card">
    <header>
      <h1>WARDIAN</h1>
      <p class="subtitle">
        Sistema de doble encriptación. La primera capa utiliza coordenadas de teclado; la segunda capa aplica una transformación numérica basada en código ASCII.
      </p>
      <div class="badges">
        <span class="badge">1. Capa I: Coordenadas</span>
        <span class="badge">2. Capa II: ASCII + 5</span>
        <span class="badge">Entrada: 1–10 caracteres</span>
      </div>
    </header>
  </div>

  <!-- ================= Capa I ================= -->
  <div class="card">
    <h2>1. Capa Wardian I · Coordenadas</h2>
    <p class="section-desc">
      Usa coordenadas de teclado para encriptar letras y números (incluye mayúsculas y dígitos codificados con M y N).
    </p>

    <label for="capa1-input">Texto o código de Capa I</label>
    <input id="capa1-input" placeholder="Ejemplo: Nicolas7 o M36183319292122N27">
    <div id="capa1-error" class="error"></div>

    <div class="button-row">
      <button id="btn-capa1-encrypt">Encriptar Capa I</button>
      <button id="btn-capa1-decrypt" class="secondary">Desencriptar Capa I</button>
    </div>

    <label style="margin-top:12px;">Resultado Capa I</label>
    <div id="capa1-output" class="output"></div>
  </div>

  <!-- ================= Capa II ================= -->
  <div class="card">
    <h2>2. Capa Wardian II · ASCII + 5</h2>
    <p class="section-desc">
      Trabaja sobre el código de la Capa I. Cada carácter se transforma a su código ASCII, se le suma 5 y se concatenan los resultados.
    </p>

    <label for="capa2-input">Código Capa I o Capa II</label>
    <textarea id="capa2-input" placeholder="Ejemplo: M36183319292122N27 o 8256595461656564625652555455555560"></textarea>
    <div id="capa2-error" class="error"></div>

    <div class="button-row">
      <button id="btn-capa2-encrypt">Encriptar Capa II</button>
      <button id="btn-capa2-decrypt" class="secondary">Desencriptar Capa II</button>
    </div>

    <label style="margin-top:12px;">Resultado Capa II</label>
    <div id="capa2-output" class="output"></div>
  </div>

  <div class="card">
    <footer>Wardian · ejercicio académico de encriptación.</footer>
  </div>
</div>

<script>
  // ======== Mapeos Capa I ========
  const lowerToCode = {
    'q': '11', 'w': '12', 'e': '13', 'r': '14', 't': '15',
    'y': '16', 'u': '17', 'i': '18', 'o': '19', 'p': '10',
    'a': '21', 's': '22', 'd': '23', 'f': '24', 'g': '25',
    'h': '26', 'j': '27', 'k': '28', 'l': '29', 'ñ': '20',
    'z': '31', 'x': '32', 'c': '33', 'v': '34', 'b': '35',
    'n': '36', 'm': '37'
  };

  const codeToLower = {};
  for (const [k, v] of Object.entries(lowerToCode)) {
    codeToLower[v] = k;
  }

  const digitToLetter = {
    '1': 'a', '2': 's', '3': 'd', '4': 'f', '5': 'g',
    '6': 'h', '7': 'j', '8': 'k', '9': 'l', '0': 'ñ'
  };

  const letterToDigit = {
    'a': '1', 's': '2', 'd': '3', 'f': '4', 'g': '5',
    'h': '6', 'j': '7', 'k': '8', 'l': '9', 'ñ': '0'
  };

  function esCaracterValido(c) {
    if (/[0-9A-Za-z]/.test(c)) return true;
    if (c === 'ñ' || c === 'Ñ') return true;
    return false;
  }

  function esTextoValido(texto) {
    if (texto.length < 1 || texto.length > 10) return false;
    for (const c of texto) {
      if (!esCaracterValido(c)) return false;
    }
    return true;
  }

  function esCodigoCapa1Valido(codigo) {
    if (!codigo.length) return false;
    return /^[0-9MN]+$/.test(codigo);
  }

  // ======== Capa I: Encriptar ========
  function encriptarCapa1(texto) {
    let resultado = "";
    for (const c of texto) {
      if (/[0-9]/.test(c)) {
        const letra = digitToLetter[c];
        const codigo = lowerToCode[letra];
        resultado += "N" + codigo; // número
      } else {
        const base = c.toLowerCase();
        const codigo = lowerToCode[base];
        if (!codigo) throw new Error("Carácter no soportado: " + c);
        const esLetra = (c.toUpperCase() !== c.toLowerCase());
        if (esLetra && c === c.toUpperCase()) {
          resultado += "M" + codigo; // mayúscula
        } else {
          resultado += codigo;       // minúscula
        }
      }
    }
    return resultado;
  }

  // ======== Capa I: Desencriptar ========
  function desencriptarCapa1(codigo) {
    let resultado = "";
    let i = 0;
    while (i < codigo.length) {
      const ch = codigo[i];

      if (ch === 'M') {
        if (i + 2 >= codigo.length) throw new Error("Código incompleto para mayúscula.");
        const token = codigo.slice(i + 1, i + 3);
        i += 3;
        const base = codeToLower[token];
        if (!base) throw new Error("Coordenada desconocida: " + token);
        resultado += base.toUpperCase();
      } else if (ch === 'N') {
        if (i + 2 >= codigo.length) throw new Error("Código incompleto para número.");
        const token = codigo.slice(i + 1, i + 3);
        i += 3;
        const base = codeToLower[token];
        if (!base || !(base in letterToDigit)) {
          throw new Error("Coordenada desconocida para número: " + token);
        }
        const dig = letterToDigit[base];
        resultado += dig;
      } else {
        if (i + 1 >= codigo.length) throw new Error("Código incompleto para minúscula.");
        const token = codigo.slice(i, i + 2);
        i += 2;
        const base = codeToLower[token];
        if (!base) throw new Error("Coordenada desconocida: " + token);
        resultado += base;
      }
    }
    return resultado;
  }

  // ======== Capa II: Encriptar ========
  function encriptarCapa2(desdeCapa1) {
    let res = "";
    for (const c of desdeCapa1) {
      const codigo = c.charCodeAt(0) + 5;
      res += String(codigo).padStart(2, "0");
    }
    return res;
  }

  // ======== Capa II: Desencriptar ========
  function desencriptarCapa2(cadenaNumerica) {
    if (!/^[0-9]+$/.test(cadenaNumerica) || cadenaNumerica.length % 2 !== 0) {
      throw new Error("El código de la Capa II debe tener solo números y largo par.");
    }
    let s1 = "";
    for (let i = 0; i < cadenaNumerica.length; i += 2) {
      const par = cadenaNumerica.slice(i, i + 2);
      const codigo = parseInt(par, 10) - 5;
      s1 += String.fromCharCode(codigo);
    }
    return s1;
  }

  // ======== UI Capa I ========
  const capa1Input  = document.getElementById("capa1-input");
  const capa1Error  = document.getElementById("capa1-error");
  const capa1Output = document.getElementById("capa1-output");

  document.getElementById("btn-capa1-encrypt").addEventListener("click", () => {
    capa1Error.textContent = "";
    capa1Output.textContent = "";
    const valor = capa1Input.value.trim();

    if (!esTextoValido(valor)) {
      capa1Error.textContent =
        "Entrada no válida. Usa entre 1 y 10 caracteres, solo letras y números, sin espacios.";
      return;
    }
    try {
      const codigo = encriptarCapa1(valor);
      capa1Output.textContent = codigo;
      capa1Output.style.color = "#e5e7eb";
    } catch (e) {
      capa1Error.textContent = e.message;
    }
  });

  document.getElementById("btn-capa1-decrypt").addEventListener("click", () => {
    capa1Error.textContent = "";
    capa1Output.textContent = "";
    const valor = capa1Input.value.trim();

    if (!esCodigoCapa1Valido(valor)) {
      capa1Error.textContent = "Para desencriptar, ingresa un código válido de Capa I (solo dígitos y M/N).";
      return;
    }
    try {
      const texto = desencriptarCapa1(valor);
      capa1Output.textContent = texto;
      capa1Output.style.color = "#e5e7eb";
    } catch (e) {
      capa1Error.textContent = e.message;
    }
  });

  // ======== UI Capa II ========
  const capa2Input  = document.getElementById("capa2-input");
  const capa2Error  = document.getElementById("capa2-error");
  const capa2Output = document.getElementById("capa2-output");

  document.getElementById("btn-capa2-encrypt").addEventListener("click", () => {
    capa2Error.textContent = "";
    capa2Output.textContent = "";
    const valor = capa2Input.value.trim();

    if (!esCodigoCapa1Valido(valor)) {
      capa2Error.textContent =
        "Para encriptar en Capa II, ingresa un código válido de Capa I (solo dígitos y M/N).";
      return;
    }
    try {
      const codigo2 = encriptarCapa2(valor);
      capa2Output.textContent = codigo2;
      capa2Output.style.color = "#e5e7eb";
    } catch (e) {
      capa2Error.textContent = e.message;
    }
  });

  document.getElementById("btn-capa2-decrypt").addEventListener("click", () => {
    capa2Error.textContent = "";
    capa2Output.textContent = "";
    const valor = capa2Input.value.trim();

    if (!valor.length) {
      capa2Error.textContent = "Ingresa un código numérico de Capa II.";
      return;
    }
    try {
      const capa1 = desencriptarCapa2(valor);
      const texto = desencriptarCapa1(capa1);
      capa2Output.innerHTML =
        "Capa I: " + capa1 + "<br>Texto original: " + texto;
      capa2Output.style.color = "#e5e7eb";
    } catch (e) {
      capa2Error.textContent = e.message;
    }
  });
</script>
</body>
</html>
