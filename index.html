<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Wardian – Doble Encriptación</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      color-scheme: dark;
      --bg-main: #050509;
      --bg-card: #0f0f13;
      --bg-input: #050509;
      --border-soft: rgba(255,255,255,0.08);
      --border-strong: rgba(255,255,255,0.16);
      --text-main: #f5f5f7;
      --text-soft: #a1a1aa;
      --accent: #007aff;
      --accent-soft: rgba(0,122,255,0.15);
      --error: #ff453a;
      --radius-card: 18px;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 40px rgba(0,0,0,0.65);
      --font-sans: -apple-system, BlinkMacSystemFont, "SF Pro Text",
                   system-ui, "Segoe UI", sans-serif;
      --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
                   "Liberation Mono", "Courier New", monospace;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: var(--font-sans);
      background: radial-gradient(circle at top, #16161c 0, #020208 60%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 24px 12px;
    }

    .shell { width: 100%; max-width: 980px; }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-card);
      padding: 24px 22px 26px;
      border: 1px solid var(--border-soft);
      margin-bottom: 18px;
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(22px);
    }

    header {
      margin-bottom: 20px;
      padding-bottom: 14px;
      border-bottom: 1px solid var(--border-soft);
    }

    header h1 {
      margin: 0 0 6px;
      font-size: 1.9rem;
      font-weight: 600;
      letter-spacing: .06em;
      text-transform: uppercase;
    }

    header .subtitle {
      font-size: .9rem;
      color: var(--text-soft);
      max-width: 520px;
    }

    .badges {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .badge {
      font-size: .75rem;
      padding: 3px 11px;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-soft);
      color: var(--text-soft);
    }

    h2 { margin: 0 0 6px; font-size: 1.05rem; font-weight: 600; }

    .section-desc {
      margin: 0 0 12px;
      color: var(--text-soft);
      font-size: .85rem;
    }

    label {
      display: block;
      margin-bottom: 4px;
      font-size: .85rem;
    }

    input, textarea {
      width: 100%;
      padding: 9px 11px;
      border-radius: 11px;
      border: 1px solid var(--border-soft);
      background: var(--bg-input);
      color: var(--text-main);
      font-size: .9rem;
    }

    textarea { min-height: 70px; resize: vertical; }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
      background: #020208;
    }

    .button-row {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    button {
      padding: 7px 16px;
      border-radius: var(--radius-pill);
      font-size: .85rem;
      border: none;
      cursor: pointer;
      font-weight: 500;
      background: var(--accent);
      color: #fff;
      box-shadow: 0 8px 18px rgba(0,122,255,0.35);
    }

    button.secondary {
      background: #18181c;
      color: var(--text-main);
      border: 1px solid var(--border-strong);
      box-shadow: none;
    }

    .output {
      margin-top: 6px;
      padding: 7px 10px;
      min-height: 32px;
      background: #050509;
      color: var(--text-soft);
      border-radius: 10px;
      border: 1px dashed var(--border-soft);
      font-family: var(--font-mono);
      font-size: .8rem;
      word-break: break-all;
      display: flex;
      align-items: center;
    }

    .error {
      margin-top: 4px;
      min-height: 14px;
      font-size: .78rem;
      color: var(--error);
    }
  </style>
</head>
<body>

<div class="shell">

  <div class="card">
    <header>
      <h1>WARDIAN</h1>
      <p class="subtitle">Sistema de doble encriptación.</p>
      <div class="badges">
        <span class="badge">Capa I</span>
        <span class="badge">Capa II</span>
        <span class="badge">Entrada: 1–10 caracteres</span>
      </div>
    </header>
  </div>

  <!-- ================= Capa I ================= -->
  <div class="card">
    <h2>1. Capa Wardian I · Coordenadas</h2>
    <p class="section-desc">Usa coordenadas de teclado para letras y números.</p>

    <label for="capa1-input">Texto o código de Capa I</label>
    <input id="capa1-input" placeholder="Ejemplo: Nicolas7 o M3618...">
    <div id="capa1-error" class="error"></div>

    <div class="button-row">
      <button id="btn-capa1-encrypt">Encriptar Capa I</button>
      <button id="btn-capa1-decrypt" class="secondary">Desencriptar</button>
    </div>

    <label style="margin-top:12px;">Resultado Capa I</label>
    <div id="capa1-output" class="output"></div>
  </div>

  <!-- ================= Capa II ================= -->
  <div class="card">
    <h2>2. Capa Wardian II · ASCII + 5</h2>
    <p class="section-desc">Convierte el código de Capa I a números mediante ASCII + 5.</p>

    <label for="capa2-input">Código Capa I o Capa II</label>
    <textarea id="capa2-input" placeholder="Ejemplo: M3618... o 82565954..."></textarea>
    <div id="capa2-error" class="error"></div>

    <div class="button-row">
      <button id="btn-capa2-encrypt">Encriptar Capa II</button>
      <button id="btn-capa2-decrypt" class="secondary">Desencriptar</button>
    </div>

    <label style="margin-top:12px;">Resultado Capa II</label>
    <div id="capa2-output" class="output"></div>
  </div>

</div>

<script>

// ======== Mapeos Capa I ========
const lowerToCode = {
  'q':'11','w':'12','e':'13','r':'14','t':'15',
  'y':'16','u':'17','i':'18','o':'19','p':'10',
  'a':'21','s':'22','d':'23','f':'24','g':'25',
  'h':'26','j':'27','k':'28','l':'29','ñ':'20',
  'z':'31','x':'32','c':'33','v':'34','b':'35',
  'n':'36','m':'37'
};

const codeToLower = {};
for (const k in lowerToCode) codeToLower[lowerToCode[k]] = k;

const digitToLetter = { '1':'a','2':'s','3':'d','4':'f','5':'g','6':'h','7':'j','8':'k','9':'l','0':'ñ' };
const letterToDigit = { 'a':'1','s':'2','d':'3','f':'4','g':'5','h':'6','j':'7','k':'8','l':'9','ñ':'0' };

function esTextoValido(t){
  if(t.length<1||t.length>10)return false;
  return [...t].every(c=>/[0-9A-Za-z]/.test(c)||c==='ñ'||c==='Ñ');
}

function esCodigoCapa1Valido(c){ return /^[0-9MN]+$/.test(c); }

// ======== Capa I Encrypt ========
function encriptarCapa1(texto){
  let r="";
  for (const c of texto){
    if(/[0-9]/.test(c)){
      const letra=digitToLetter[c];
      r+="N"+lowerToCode[letra];
    } else {
      const base=c.toLowerCase();
      const code=lowerToCode[base];
      if(!code) throw Error("Carácter no soportado: "+c);
      if(c===c.toUpperCase()) r+="M"+code;
      else r+=code;
    }
  }
  return r;
}

// ======== Capa I Decrypt ========
function desencriptarCapa1(c){
  let r="",i=0;
  while(i<c.length){
    const ch=c[i];
    if(ch==="M"){
      const token=c.slice(i+1,i+3); i+=3;
      r+=codeToLower[token].toUpperCase();
    } else if(ch==="N"){
      const token=c.slice(i+1,i+3); i+=3;
      r+=letterToDigit[codeToLower[token]];
    } else {
      const token=c.slice(i,i+2); i+=2;
      r+=codeToLower[token];
    }
  }
  return r;
}

// ======== Capa II Encrypt ========
function encriptarCapa2(c1){
  let r="";
  for(const c of c1) r+=(c.charCodeAt(0)+5).toString().padStart(2,"0");
  return r;
}

// ======== Capa II Decrypt ========
function desencriptarCapa2(c2){
  if(!/^[0-9]+$/.test(c2)||c2.length%2!==0) throw Error("Código inválido.");
  let r="";
  for(let i=0;i<c2.length;i+=2){
    r+=String.fromCharCode(parseInt(c2.slice(i,i+2))-5);
  }
  return r;
}

// ====================== UI ======================

// ---- Capa I ----
const c1I=document.getElementById("capa1-input");
const c1O=document.getElementById("capa1-output");
const c1E=document.getElementById("capa1-error");

document.getElementById("btn-capa1-encrypt").onclick=()=>{
  c1E.textContent=""; c1O.textContent="";
  const v=c1I.value.trim();
  if(!esTextoValido(v)){ c1E.textContent="Entrada no válida."; return; }
  try{ c1O.textContent=encriptarCapa1(v);}catch(e){c1E.textContent=e.message;}
};

document.getElementById("btn-capa1-decrypt").onclick=()=>{
  c1E.textContent=""; c1O.textContent="";
  const v=c1I.value.trim();
  if(!esCodigoCapa1Valido(v)){c1E.textContent="Código inválido.";return;}
  try{ c1O.textContent=desencriptarCapa1(v);}catch(e){c1E.textContent=e.message;}
};

// ---- Capa II ----
const c2I=document.getElementById("capa2-input");
const c2O=document.getElementById("capa2-output");
const c2E=document.getElementById("capa2-error");

document.getElementById("btn-capa2-encrypt").onclick=()=>{
  c2E.textContent=""; c2O.textContent="";
  const v=c2I.value.trim();
  if(!esCodigoCapa1Valido(v)){c2E.textContent="Código de Capa I inválido.";return;}
  try{ c2O.textContent=encriptarCapa2(v);}catch(e){c2E.textContent=e.message;}
};

document.getElementById("btn-capa2-decrypt").onclick=()=>{
  c2E.textContent=""; c2O.textContent="";
  const v=c2I.value.trim();
  if(!v){c2E.textContent="Ingresa código.";return;}
  try{
    const capa1=desencriptarCapa2(v);
    c2O.textContent=capa1;  // SOLO muestra Capa I reconstruida
  } catch(e){ c2E.textContent=e.message; }
};

</script>
</body>
</html>

